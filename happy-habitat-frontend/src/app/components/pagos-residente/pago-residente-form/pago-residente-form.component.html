<div class="p-4 max-w-2xl mx-auto">
  <div class="flex items-center justify-between gap-4 mb-4">
    <h1 class="text-2xl font-bold flex items-center gap-2">
      <i class="fa-solid fa-money-bill-1-wave text-primary"></i>
      {{ title }}
    </h1>
    <button type="button" class="btn btn-secondary text-white" (click)="cancel()">
      Regresar
    </button>
  </div>

  <div class="bg-base-200 rounded-lg p-4">
  @if (isLoading()) {
    <div class="flex justify-center items-center py-12">
      <span class="loading loading-spinner loading-lg"></span>
      <span class="ml-4">Cargando...</span>
    </div>
  } @else {
    @if (errorMessage()) {
      <div class="alert alert-error mb-4">
        <i class="fa-solid fa-circle-exclamation"></i>
        <span>{{ errorMessage() }}</span>
      </div>
    }

    <form class="space-y-6" (ngSubmit)="submit()">
      @if (isEditMode()) {
        <div class="flex flex-wrap items-center gap-3">
          <div class="flex items-center gap-2 flex-1 min-w-0">
            <span class="font-bold text-black shrink-0">Residente:</span>
            <span>{{ displayedResidentName() }}</span>
          </div>
          <div class="flex items-center gap-2">
            <label for="fechaPago" class="font-bold text-black shrink-0">Fecha pago:</label>
            <input id="fechaPago" type="date" class="input input-bordered input-sm w-[10.5rem]" [(ngModel)]="form.fechaPago" name="fechaPago" required />
          </div>
        </div>
      } @else {
        <div class="form-control w-full">
          @if (selectedComunidadName()) {
            <p class="font-bold text-black mb-3">Comunidad: {{ selectedComunidadName() }}</p>
          }
          <div class="flex flex-wrap items-center gap-3">
            <div class="flex items-center gap-2 flex-1 min-w-0">
              <label for="residenteId" class="font-bold text-black shrink-0">Residente:</label>
              <select
                id="residenteId"
                class="select select-bordered flex-1 min-w-0"
                [(ngModel)]="form.residenteId"
                name="residenteId"
                required
                [disabled]="!!residentIdFromRoute() || form.residenteId === 'all'"
              >
                <option value="">Seleccione un residente</option>
                @if (!residentIdFromRoute() && residentsOptions().length) {
                  <option value="all">Todos los residentes de la comunidad</option>
                }
                @for (r of residentsOptions(); track r.residentId ?? r.id) {
                  <option [value]="r.residentId ?? r.id">{{ r.fullname }} {{ r.number ? '(' + r.number + ')' : '' }}</option>
                }
              </select>
            </div>
            <div class="flex items-center gap-2">
              <label for="fechaPago" class="font-bold text-black shrink-0">Fecha pago:</label>
              <input id="fechaPago" type="date" class="input input-bordered input-sm w-[10.5rem]" [(ngModel)]="form.fechaPago" name="fechaPago" required />
            </div>
          </div>
        </div>
      }

      <div class="flex flex-wrap items-center gap-3">
        <div class="flex items-center gap-2">
          <label for="monto" class="font-bold text-black shrink-0">Monto:</label>
          <input id="monto" type="number" step="0.01" min="0" class="input input-bordered input-sm w-28" [(ngModel)]="form.monto" name="monto" required placeholder="0.00" />
        </div>
        <div class="flex items-center gap-2">
          <label for="status" class="font-bold text-black shrink-0">Estatus:</label>
          <select id="status" class="select select-bordered select-sm w-40" [(ngModel)]="form.status" name="status" required>
            @for (opt of statusOpciones; track opt.value) {
              <option [value]="opt.value">{{ opt.label }}</option>
            }
          </select>
        </div>
      </div>

      <div class="form-control w-full">
        <label class="label py-0" for="concepto"><span class="label-text font-bold text-black">Concepto:</span></label>
        <input id="concepto" type="text" class="input input-bordered w-full" [(ngModel)]="form.concepto" name="concepto" placeholder="Ej. Mantenimiento, Cuota de agua" maxlength="500" />
      </div>

      <div class="form-control w-full">
        <label class="label py-0" for="urlComprobante"><span class="label-text font-bold text-black">URL comprobante (opcional):</span></label>
        <input id="urlComprobante" type="url" class="input input-bordered w-full" [(ngModel)]="form.urlComprobante" name="urlComprobante" placeholder="https://..." maxlength="2000" />
      </div>

      <div class="form-control w-full">
        <label class="label py-0" for="nota"><span class="label-text font-bold text-black">Nota (opcional):</span></label>
        <textarea id="nota" class="textarea textarea-bordered w-full min-h-[80px]" [(ngModel)]="form.nota" name="nota" placeholder="Nota o referencia del pago"></textarea>
      </div>

      <div class="flex justify-center gap-3 pt-4">
        <button type="submit" class="btn btn-primary text-white" [disabled]="isSaving()">
          @if (isSaving()) {
            <span class="loading loading-spinner loading-sm"></span>
            Guardando...
          } @else {
            Guardar
          }
        </button>
        <button type="button" class="btn btn-ghost" (click)="cancel()">
          Cancelar
        </button>
      </div>
    </form>
  }
  </div>
</div>
