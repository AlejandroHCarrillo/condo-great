<div class="p-4 max-w-2xl mx-auto">
  <div class="flex items-center justify-between gap-4 mb-6">
    <h1 class="text-2xl font-bold flex items-center gap-2">
      <i class="fa-solid fa-truck text-primary"></i>
      {{ title }}
    </h1>
    <button type="button" class="btn btn-secondary text-white" (click)="cancel()">
      Regresar
    </button>
  </div>

  @if (isLoading()) {
    <div class="flex justify-center items-center py-12">
      <span class="loading loading-spinner loading-lg"></span>
      <span class="ml-4">Cargando...</span>
    </div>
  } @else {
    @if (errorMessage()) {
      <div class="alert alert-error mb-4">
        <i class="fa-solid fa-circle-exclamation"></i>
        <span>{{ errorMessage() }}</span>
      </div>
    }

    <form class="space-y-6" (ngSubmit)="save()">
      <div class="form-control w-full">
        <label class="label" for="communityId"><span class="label-text font-medium">Comunidad</span></label>
        <select
          id="communityId"
          class="select select-bordered w-full"
          [(ngModel)]="form.communityId"
          name="communityId"
          required
          [disabled]="!!communityIdFromRoute()"
        >
          <option value="">Seleccione una comunidad</option>
          @for (c of comunidadesAsociadas(); track c.id) {
            <option [value]="c.id">{{ c.nombre }}</option>
          }
        </select>
      </div>

      <div class="divider font-semibold">Datos generales</div>
      <div class="form-control w-full">
        <label class="label" for="businessName"><span class="label-text font-medium">Nombre o razón social</span></label>
        <input id="businessName" type="text" class="input input-bordered w-full" [(ngModel)]="form.businessName" name="businessName" required />
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div class="form-control w-full">
          <label class="label" for="taxId"><span class="label-text font-medium">RFC / Identificación fiscal</span></label>
          <input id="taxId" type="text" class="input input-bordered w-full" [(ngModel)]="form.taxId" name="taxId" placeholder="Opcional" />
        </div>
        <div class="form-control w-full">
          <label class="label" for="categoryOrIndustry"><span class="label-text font-medium">Categoría o giro</span></label>
          <input id="categoryOrIndustry" type="text" class="input input-bordered w-full" [(ngModel)]="form.categoryOrIndustry" name="categoryOrIndustry" placeholder="Ej. alimentos, plomería" />
        </div>
      </div>
      <div class="form-control w-full">
        <label class="label" for="fullAddress"><span class="label-text font-medium">Dirección completa</span></label>
        <input id="fullAddress" type="text" class="input input-bordered w-full" [(ngModel)]="form.fullAddress" name="fullAddress" placeholder="Opcional" />
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div class="form-control w-full">
          <label class="label" for="contactPhones"><span class="label-text font-medium">Teléfonos de contacto</span></label>
          <input id="contactPhones" type="text" class="input input-bordered w-full" [(ngModel)]="form.contactPhones" name="contactPhones" placeholder="Opcional" />
        </div>
        <div class="form-control w-full">
          <label class="label" for="primaryEmail"><span class="label-text font-medium">Correo electrónico principal</span></label>
          <input id="primaryEmail" type="email" class="input input-bordered w-full" [(ngModel)]="form.primaryEmail" name="primaryEmail" placeholder="Opcional" />
        </div>
      </div>
      <div class="form-control w-full">
        <label class="label" for="websiteOrSocialMedia"><span class="label-text font-medium">Página web / Redes sociales</span></label>
        <input id="websiteOrSocialMedia" type="text" class="input input-bordered w-full" [(ngModel)]="form.websiteOrSocialMedia" name="websiteOrSocialMedia" placeholder="Opcional" />
      </div>

      <div class="divider font-semibold">Contacto principal</div>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div class="form-control w-full">
          <label class="label" for="primaryContactName"><span class="label-text font-medium">Nombre contacto principal</span></label>
          <input id="primaryContactName" type="text" class="input input-bordered w-full" [(ngModel)]="form.primaryContactName" name="primaryContactName" placeholder="Opcional" />
        </div>
        <div class="form-control w-full">
          <label class="label" for="contactEmail"><span class="label-text font-medium">Correo electrónico</span></label>
          <input id="contactEmail" type="email" class="input input-bordered w-full" [(ngModel)]="form.contactEmail" name="contactEmail" placeholder="Opcional" />
        </div>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div class="form-control w-full">
          <label class="label" for="directPhone"><span class="label-text font-medium">Teléfono directo</span></label>
          <input id="directPhone" type="text" class="input input-bordered w-full" [(ngModel)]="form.directPhone" name="directPhone" placeholder="Opcional" />
        </div>
        <div class="form-control w-full">
          <label class="label" for="mobilePhone"><span class="label-text font-medium">Teléfono móvil</span></label>
          <input id="mobilePhone" type="text" class="input input-bordered w-full" [(ngModel)]="form.mobilePhone" name="mobilePhone" placeholder="Opcional" />
        </div>
      </div>

      <div class="divider font-semibold">Productos / Servicios y pago</div>
      <div class="form-control w-full">
        <label class="label" for="productsOrServices"><span class="label-text font-medium">Productos o servicios que ofrece</span></label>
        <textarea id="productsOrServices" class="textarea textarea-bordered w-full min-h-[80px]" [(ngModel)]="form.productsOrServices" name="productsOrServices" placeholder="Opcional"></textarea>
      </div>
      <div class="form-control w-full">
        <label class="label" for="paymentMethods"><span class="label-text font-medium">Formas de pago</span></label>
        <input id="paymentMethods" type="text" class="input input-bordered w-full" [(ngModel)]="form.paymentMethods" name="paymentMethods" placeholder="Ej. crédito, contado, plazos" />
      </div>
      <div class="form-control w-full max-w-xs">
        <label class="label" for="rating"><span class="label-text font-medium">Calificación</span></label>
        <input id="rating" type="number" min="0" max="5" step="0.1" class="input input-bordered w-full" [(ngModel)]="form.rating" name="rating" placeholder="0-5" />
      </div>

      <div class="divider font-semibold">Historial y notas</div>
      <div class="form-control w-full">
        <label class="label" for="orderHistory"><span class="label-text font-medium">Historial de pedidos realizados</span></label>
        <textarea id="orderHistory" class="textarea textarea-bordered w-full min-h-[60px]" [(ngModel)]="form.orderHistory" name="orderHistory" placeholder="Opcional"></textarea>
      </div>
      <div class="form-control w-full">
        <label class="label" for="pastIncidentsOrClaims"><span class="label-text font-medium">Incidencias o reclamaciones pasadas</span></label>
        <textarea id="pastIncidentsOrClaims" class="textarea textarea-bordered w-full min-h-[60px]" [(ngModel)]="form.pastIncidentsOrClaims" name="pastIncidentsOrClaims" placeholder="Opcional"></textarea>
      </div>
      <div class="form-control w-full">
        <label class="label" for="internalNotes"><span class="label-text font-medium">Notas internas</span></label>
        <textarea id="internalNotes" class="textarea textarea-bordered w-full min-h-[60px]" [(ngModel)]="form.internalNotes" name="internalNotes" placeholder="Opcional"></textarea>
      </div>

      <div class="flex justify-center gap-3 pt-4">
        <button type="submit" class="btn btn-primary text-white" [disabled]="isSaving()">
          @if (isSaving()) {
            <span class="loading loading-spinner loading-sm"></span>
            Guardando...
          } @else {
            Guardar
          }
        </button>
        <button type="button" class="btn btn-ghost" (click)="cancel()">
          Cancelar
        </button>
      </div>
    </form>
  }
</div>
