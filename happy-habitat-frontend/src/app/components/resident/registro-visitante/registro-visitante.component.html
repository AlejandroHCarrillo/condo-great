<div class="w-full max-w-4xl p-4 sm:p-6 md:p-8 ">
    <!-- T√≠tulo -->
    <h2 class="text-xl sm:text-2xl md:text-3xl font-bold mb-4 sm:mb-6 flex items-center gap-2">
        <i class="fa-solid fa-users-viewfinder text-primary"></i>
        <span>Registro visitantes</span>
    </h2>
    
    <!-- Formulario -->
    <div class="card bg-base-100 shadow-lg  bg-base-200">
        <div class="card-body p-4 sm:p-6 md:p-8">
            <form [formGroup]="myForm" (ngSubmit)="onSave()" class="space-y-4 sm:space-y-6">
                
                <!-- üßç Nombre + üë• Total de personas -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div class="form-control">
                        <label class="label font-semibold" for="name">
                            <span class="label-text">Nombre del visitante</span>
                        </label>
                        <input 
                            id="name" 
                            type="text" 
                            formControlName="name" 
                            class="input input-bordered w-full"
                            [class.input-error]="!formUtils.isValidField(myForm, 'name')"
                            placeholder="Ingrese el nombre completo"
                        />
                        <show-form-error-template
                            [isValid]="formUtils.isValidField(myForm, 'name')"
                            [errorMessage]="formUtils.getFieldError(myForm, 'name') || ''"
                        />
                    </div>

                    <div class="form-control">
                        <label class="label font-semibold" for="totalpersons">
                            <span class="label-text">N√∫mero de personas</span>
                        </label>
                        <input 
                            id="totalpersons" 
                            type="number" 
                            formControlName="totalpersons" 
                            class="input input-bordered w-full"
                            [class.input-error]="!formUtils.isValidField(myForm, 'totalpersons')"
                            min="1"
                            placeholder="1"
                        />
                        <show-form-error-template
                            [isValid]="formUtils.isValidField(myForm, 'totalpersons')"
                            [errorMessage]="formUtils.getFieldError(myForm, 'totalpersons') || ''"
                        />
                    </div>
                </div>

                <!-- üìù Motivo de la visita (Selecci√≥n r√°pida) -->
                <div class="form-control">
                    <label class="label font-semibold" for="quickSubject">
                        <span class="label-text">Motivo de la visita (Selecci√≥n r√°pida)</span>
                    </label>
                    <select 
                        id="quickSubject"
                        class="select select-bordered w-full" 
                        formControlName="quickSubject"
                        (change)="onQuickSubjectChange()"
                    >
                        <option value="">Seleccione un motivo o escriba uno personalizado abajo</option>
                        @for (motivo of motivosVisita; track $index) {
                            <option [value]="motivo">{{ motivo }}</option>
                        }
                    </select>
                </div>

                <!-- üìù Asunto -->
                <div class="form-control">
                    <label class="label font-semibold" for="subject">
                        <span class="label-text">Asunto de la visita</span>
                    </label>
                    <textarea 
                        id="subject" 
                        formControlName="subject" 
                        class="textarea textarea-bordered w-full min-h-24"
                        [class.textarea-error]="!formUtils.isValidField(myForm, 'subject')"
                        placeholder="Describa el motivo de la visita o seleccione uno de la lista de arriba..."
                    ></textarea>
                    <show-form-error-template
                        [isValid]="formUtils.isValidField(myForm, 'subject')"
                        [errorMessage]="formUtils.getFieldError(myForm, 'subject') || ''"
                    />
                </div>

                <!-- üöó Informaci√≥n del veh√≠culo -->
                <div class="divider">
                    <span class="text-sm text-base-content/60">Informaci√≥n del veh√≠culo (opcional)</span>
                </div>

                <!-- üöó Descripci√≥n + üé® Color + üî¢ Placas -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="form-control">
                        <label class="label font-semibold" for="cardescription">
                            <span class="label-text hidden sm:inline">Descripci√≥n del veh√≠culo</span>
                            <span class="label-text sm:hidden">Descripci√≥n</span>
                        </label>
                        <input 
                            id="cardescription" 
                            type="text" 
                            formControlName="cardescription" 
                            class="input input-bordered w-full"
                            placeholder="Ej: Sed√°n, SUV, etc."
                        />
                        <show-form-error-template
                            [isValid]="formUtils.isValidField(myForm, 'cardescription')"
                            [errorMessage]="formUtils.getFieldError(myForm, 'cardescription') || ''"
                        />
                    </div>

                    <div class="form-control">
                        <label class="label font-semibold" for="carcolor">
                            <span class="label-text">Color</span>
                        </label>
                        <select 
                            class="select select-bordered w-full" 
                            formControlName="carcolor"
                        >
                            <option value="">Seleccione un color</option>
                            @for (color of colores; track $index) {
                                <option [value]="color">{{ color | titlecase }}</option>
                            }
                        </select>
                        <show-form-error-template
                            [isValid]="formUtils.isValidField(myForm, 'carcolor')"
                            [errorMessage]="formUtils.getFieldError(myForm, 'carcolor') || ''"
                        />
                    </div>

                    <div class="form-control">
                        <label class="label font-semibold" for="carplates">
                            <span class="label-text">Placas</span>
                        </label>
                        <input 
                            id="carplates" 
                            type="text" 
                            formControlName="carplates" 
                            class="input input-bordered w-full"
                            placeholder="ABC-123"
                        />
                        <show-form-error-template
                            [isValid]="formUtils.isValidField(myForm, 'carplates')"
                            [errorMessage]="formUtils.getFieldError(myForm, 'carplates') || ''"
                        />
                    </div>
                </div>

                <!-- üìÖ Fechas de ingreso y salida -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div class="form-control">
                        <label class="label font-semibold" for="arriveDate">
                            <span class="label-text">Fecha de ingreso</span>
                        </label>
                        <input 
                            id="arriveDate" 
                            type="date" 
                            formControlName="arriveDate" 
                            class="input input-bordered w-full"
                            [class.input-error]="!formUtils.isValidField(myForm, 'arriveDate')"
                        />
                        <show-form-error-template
                            [isValid]="formUtils.isValidField(myForm, 'arriveDate')"
                            [errorMessage]="formUtils.getFieldError(myForm, 'arriveDate') || ''"
                        />
                    </div>
                    
                    <div class="form-control">
                        <label class="label font-semibold" for="departureDate">
                            <span class="label-text">Fecha de salida</span>
                        </label>
                        <input 
                            id="departureDate" 
                            type="date" 
                            formControlName="departureDate" 
                            class="input input-bordered w-full"
                        />
                        <show-form-error-template
                            [isValid]="formUtils.isValidField(myForm, 'departureDate')"
                            [errorMessage]="formUtils.getFieldError(myForm, 'departureDate') || ''"
                        />
                    </div>
                </div>

                <!-- ‚úÖ Bot√≥n de env√≠o -->
                <div class="form-control mt-6 flex justify-start sm:justify-end gap-2">
                    @if (editingVisitId) {
                        <button 
                            type="button" 
                            class="btn btn-ghost w-full sm:w-auto"
                            (click)="editingVisitId = null; myForm.reset({ name: '', totalpersons: 1, quickSubject: '', cardescription: '', carcolor: '', carplates: '', subject: '', arriveDate: '', departureDate: '' })"
                        >
                            Cancelar edici√≥n
                        </button>
                    }
                    <button 
                        type="submit" 
                        class="btn btn-primary text-white w-full sm:w-auto min-w-32"
                        [disabled]="myForm.invalid || isSubmitting"
                    >
                        @if (isSubmitting) {
                            <span class="loading loading-spinner loading-sm"></span>
                        } @else {
                            <i class="fa-solid fa-save mr-2"></i>
                        }
                        {{ editingVisitId ? 'Actualizar visita' : 'Registrar visita' }}
                    </button>
                </div>

            </form>
        </div>
    </div>

    <!-- Lista de visitas del residente -->
    @if (isLoadingVisits()) {
        <div class="card bg-base-200 shadow mt-6">
            <div class="card-body items-center py-8">
                <span class="loading loading-spinner loading-lg text-primary"></span>
                <p class="text-base-content/70 mt-4">Cargando visitas...</p>
            </div>
        </div>
    } @else {
        <div class="mt-6">
            <hh-generic-list
                [items]="visits()"
                [columns]="visitColumns"
                [title]="'Mis Visitantes'"
                [itemsPerPage]="10"
                [showActions]="true"
                [canEdit]="isFutureVisit"
                [canDelete]="isFutureVisit"
                (rowClick)="onVisitClick($event)"
                (edit)="onEditVisit($event)"
                (delete)="onDeleteVisit($event)"
            ></hh-generic-list>
        </div>
    }
</div>
